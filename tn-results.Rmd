---
title: "Project A"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

# Loading libraries
```{r, message=FALSE}
library(tidyverse)
library(urbnmapr)
library(sf)
```

# Load in data
```{r}
# Importing data from all states
county_results <- read.csv("countypres_2000-2016.csv")
```

# Cleaning data

## Filtering for Tennessee
```{r}
# Narrowing to Tennessee only
county_results <- county_results %>% 
  filter(state == "Tennessee") %>% 
  select(-state_po, -office)
```

### Exporting .csv of all TN election data from 2000-2016
I am leaving this commented out so that it does not produce a new .csv very time.
```{r}
# Writing .csv of full Tennessee data (for lab submission only)
# write_csv(county_results, "Tennessee.csv")
```

## Selecting necessary columns
I added FIPS so that I can merge the data onto the choropleth map later in the project.
```{r}
county_results <- county_results %>% 
  select(year, county, party, candidate, candidatevotes, totalvotes, FIPS)
```

## Renaming columns
I am using the Tidy Data format. Selecting one party so there are no NA values?
```{r}
county_results <- county_results %>% 
  rename(candidate_votes = candidatevotes) %>% 
  rename(total_votes = totalvotes) %>% 
  rename(county_fips = FIPS)

# Converting county_fips to characters
county_results$county_fips <- as.character(county_results$county_fips)
```

## Filtering to just one election year and political party
2008? Because Obama?
```{r}
county_results_08 <- county_results %>% 
  filter(year == 2008) %>% 
  filter(party == "democrat")
```

## Calculating percent of vote
```{r}
county_results_08 <- county_results_08 %>% 
  mutate(percent_vote = 100 * (candidate_votes / total_votes))
```

### Exporting .csv of clean data
This .csv file includes data for Barack Obama's 2008 election results for all counties in Tennessee.
```{r}
# Writing .csv (for lab submission only)
# write_csv(county_results_08, "tn-2008-democrats.csv")
```

# Data visualization
Talk about different visualization techniques.

## Choropleth Map
I am using the `urbanmapr` package and referencing their vignette which can be accessed *[here](https://github.com/UrbanInstitute/urbnmapr/blob/master/vignettes/introducing-urbnmapr.Rmd)*.
```{r}
# Filtering counties data set to only Tennessee
tn_counties <- counties %>% 
  filter(state_name == "Tennessee")

# Creating map
tn_counties %>% 
  ggplot(aes(long, lat, group = group)) +
  geom_polygon(fill = "grey", color = "#ffffff", size = 0.25) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45)
```

### Merging data on to map
Using `left_join()` to combine data frames
```{r, warning=FALSE}
# Left join
dem_results_08 <- left_join(county_results_08, tn_counties, by = "county_fips")

# Adding election results to map
dem_results_08 %>% 
  ggplot(aes(long, lat, group = group, fill = percent_vote)) +
  geom_polygon(color = "#ffffff", size = 0.25) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45)

```

